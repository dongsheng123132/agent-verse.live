const { ethers } = require("ethers");

async function deploy() {
  // Conflux eSpace Testnet
  const provider = new ethers.JsonRpcProvider("https://evmtestnet.confluxrpc.com");
  
  // ÁßÅÈí•ÔºàÂ∑≤Êèê‰æõÔºâ
  const privateKey = "95bf9d328a8c926b41b870a7890257c3f1a0422c8acc6625abae40b180ea12d8";
  const wallet = new ethers.Wallet(privateKey, provider);
  
  console.log("üöÄ ÈÉ®ÁΩ≤ RedPacketDemo ÂêàÁ∫¶ÔºàÊºîÁ§∫Ê®°Âºè - Êó†ÈôêÈ¢ÜÂèñÔºâ");
  console.log("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ");
  console.log("ÈÉ®ÁΩ≤Ë¥¶Êà∑:", wallet.address);
  
  const balance = await provider.getBalance(wallet.address);
  console.log("Ë¥¶Êà∑‰ΩôÈ¢ù:", ethers.formatEther(balance), "CFX");
  
  if (balance === 0n) {
    console.error("‚ùå Ë¥¶Êà∑‰ΩôÈ¢ù‰∏∫Èõ∂ÔºÅ");
    console.log("ËØ∑ÂÖàÈ¢ÜÂèñÊµãËØïÂ∏Å: https://faucet.confluxnetwork.org/");
    process.exit(1);
  }

  // ÂêàÁ∫¶Â≠óËäÇÁ†ÅÂíå ABI
  const bytecode = "0x608060405234801561000f575f5ffd5b50604051611a81380380611a81833981810160405281019061003191906100c3565b335f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550816001819055508060028190555060005f60048190555060005f6005819055505050610101565b5f5ffd5b5f819050919050565b6100a281610090565b81146100ac575f5ffd5b50565b5f815190506100bd81610099565b92915050565b5f5f604083850312156100d9576100d861008c565b5b5f6100e6858286016100af565b92505060206100f7858286016100af565b9150509250929050565b61196b8061011d5f395ff3fe6080604052600436106100dc575f3560e01c80639b2cb5d81161007d578063c2c5f49a11610058578063c2c5f49a146101f4578063d4c9a70f1461022e578063e32e4c4d1461026a576100dc565b80639b2cb5d814610183578063a6e6643e146101ad578063ad7a672f146101d9576100dc565b80633f7dd76e116100b85780633f7dd76e146101225780634e71d92d1461014c5780635f48f3931461015357806373b2e80e1461017a576100dc565b806312065fe0146100e057806329dcb7631461010a575b5f5ffd5b3480156100eb575f5ffd5b506100f4610296565b6040516101019190610f55565b60405180910390f35b348015610115575f5ffd5b5061011e61029c565b005b34801561012d575f5ffd5b50610136610460565b6040516101439190610f55565b60405180910390f35b61014b610466565b005b34801561015e575f5ffd5b50610167610695565b6040516101749190610f55565b60405180910390f35b348015610188575f5ffd5b5061019161069b565b60405161019e9190610f7d565b60405180910390f35b3480156101b8575f5ffd5b506101d760048036038101906101d29190611009565b6106c1565b005b3480156101e4575f5ffd5b506101ed610893565b6040516101fa9190610f55565b60405180910390f35b34801561020d575f5ffd5b50610228600480360381019061022391906110cc565b610899565b005b348015610239575f5ffd5b50610254600480360381019061024f9190611009565b610a0d565b6040516102619190610f7d565b60405180910390f35b348015610275575f5ffd5b5061027e610a2a565b60405161028b9190610f55565b60405180910390f35b60035481565b60015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610334576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161032b9061119d565b60405180910390fd5b5f3411610376576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161036d90611205565b60405180910390fd5b3460035f8282546103879190611250565b925050819055503373ffffffffffffffffffffffffffffffffffffffff167fe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c346040516103d49190610f55565b60405180910390a2565b60015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60025481565b5f60015447101561043e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161043590611271565b60405180910390fd5b6001811161047e576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610475906112d9565b60405180910390fd5b5f600181106104c2576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104b990611343565b60405180910390fd5b6002546001541015610506576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104fd906113ab565b60405180910390fd5b5f5b60018110156105de57600260015f858154811061052a576105296113c9565b5b905f5260205f20908101549092509050816002015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550816003015f8282546105889190611250565b92505081905550806005015f8282546105a29190611250565b925050819055503373ffffffffffffffffffffffffffffffffffffffff167f47cee97cb7acd717b3c0aa1435d004cd5b3c8c57d70dbceb4e4458bbd60e39d48483600301546040516105fd929190611404565b60405180910390a18080600101915050610508565b5050565b60045481565b60055481565b5f6005602052805f5260405f205f915054906101000a900460ff1681565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146106c6575f5ffd5b5f821180156106d457508181115b610713576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161070a90611457565b60405180910390fd5b81600181905550806002819055507f0936b3616d5072fa8f7381ef8e7c35d39bed9ecfb2184e908a56027ad5c0b6bc8282604051610752929190610404565b60405180910390a15050565b5f47905090565b60015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146107fd576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107f49061119d565b60405180910390fd5b5f4790505f8111610843576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161083a90611271565b60405180910390fd5b5f5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1682604051610888906114c1565b5f6040518083038185875af1925050503d805f81146108c2576040519150601f19603f3d011682016040523d82523d5f602084013e6108c7565b606091505b505090508061090b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610902906114cf565b60405180910390fd5b7f99d7f8b71cfb9126984f7a5eed3a40e64a8959e9b0e442221546fb04ec6a489c8260405161093a9190610f55565b60405180910390a15050565b60015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146109e5576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016109dc9061119d565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610a53576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a4a9061153d565b60405180910390fd5b805f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b5f60015f8381548110610a2157610a2061155b565b5b905f5260205f2001549050919050565b5f7fb99453e5c01e5aa89a9982673348a0a065e64b90c09409470388a6d34060d47260015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1660035444600454600554604051610a899594939291906115b9565b60405180910390a160015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1660035460035f828254610ac29190611250565b92505081905550600354905090565b5f819050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f610b0a82610af2565b9150610b1583610af2565b9250828201905080821115610b2d57610b2c610b03565b5b92915050565b5f819050919050565b610b4281610b30565b8114610b4c575f5ffd5b50565b5f81519050610b5d81610b39565b92915050565b5f5ffd5b5f5ffd5b5f5ffd5b5f5ffd5b5f5ffd5b5f5f60408385031215610b8e57610b8d610b63565b5b5f610b9b85828601610b50565b9250506020610bac85828601610b50565b9150509250929050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f610bdf82610bb6565b9050919050565b610bef81610bd5565b8114610bf9575f5ffd5b50565b5f81359050610c0a81610be6565b92915050565b5f5ffd5b5f60208284031215610c2857610c27610c11565b5b5f610c3584828501610bfc565b91505092915050565b5f8115159050919050565b610c5281610c3e565b82525050565b5f602082019050610c6b5f830184610c49565b92915050565b610c7a81610bd5565b82525050565b5f602082019050610c935f830184610c71565b92915050565b5f82825260208201905092915050565b7f4f6e6c79206f776e6572000000000000000000000000000000000000000000005f82015250565b5f610cd9600a83610c99565b9150610ce482610ca9565b602082019050919050565b5f6020820190508181035f830152610d0681610ccc565b9050919050565b7f496e76616c69642072616e6765000000000000000000000000000000000000005f82015250565b5f610d41600d83610c99565b9150610d4c82610d0d565b602082019050919050565b5f6020820190508181035f830152610d6e81610d35565b9050919050565b7f4d7573742073656e6420434658000000000000000000000000000000000000005f82015250565b5f610da9600d83610c99565b9150610db482610d76565b602082019050919050565b5f6020820190508181035f830152610dd681610d9d565b9050919050565b7f5472616e73666572206661696c656400000000000000000000000000000000005f82015250565b5f610e14600f83610c99565b9150610e1f82610ddf565b602082019050919050565b5f6020820190508181035f830152610e4181610e07565b9050919050565b5f604082019050610e5c5f830185610c71565b610e696020830184610c71565b9392505050565b5f6080601b9050919050565b5f610e8582610e70565b9050919050565b5f610e9682610e78565b9050919050565b5f610ea782610e8b565b9050919050565b610ebf610eba82610bd5565b610e9d565b82525050565b5f610ed08286610eae565b602082019150610ee08285610eb6565b601482019150610ef08284610c71565b60208201915081905095945050505050565b7f496e73756666696369656e742062616c616e63650000000000000000000000005f82015250565b5f610f33601083610c99565b9150610f3e82610efb565b602082019050919050565b5f6020820190508181035f830152610f6081610f26565b9050919050565b610f6f81610af2565b82525050565b5f602082019050610f885f830184610f66565b92915050565b5f819050919050565b610f9f81610f8e565b8114610fa9575f5ffd5b50565b5f81359050610fba81610f96565b92915050565b5f60208284031215610fd557610fd4610c11565b5b5f610fe284828501610fac565b91505092915050565b5f6080601b9050919050565b5f61100182610fe9565b9050919050565b5f61101282610ff7565b9050919050565b5f61102382611018565b9050919050565b61103b61103682610bd5565b611011565b82525050565b5f61104c8287611023565b60208201915061105c8286611042565b60148201915081905095945050505050565b5f61107882610af2565b915061108383610af2565b9250826110935761109261105c565b5b828206905092915050565b7f496e76616c6964206164647265737300000000000000000000000000000000005f82015250565b5f6110cc600f83610c99565b91506110d782611093565b602082019050919050565b5f6020820190508181035f8301526110f9816110c0565b9050919050565b5f61110a82610af2565b915061111583610af2565b925082820390508181111561112d5761112c61105c565b5b92915050565b5f819050919050565b5f819050919050565b5f61115661115182611138565b61113c565b82525050565b5f819050919050565b5f61117661117182610af2565b61115c565b82525050565b5f8160601b9050919050565b5f61119282611181565b9050919050565b5f6111a382611198565b9050919050565b6111bb6111b682610bd5565b611199565b82525050565b5f6111cc828761114d565b6020820191506111dc828661116c565b6014820191506111ec82856111ba565b60148201915081905095945050505050565b7f42617463682074696d6573206d75737420626520312d313030000000000000005f82015250565b5f611234600e83610c99565b915061123f826111fb565b602082019050919050565b5f6020820190508181035f83015261126181611227565b9050919050565b5f819050919050565b61127681610af2565b82525050565b5f60208201905061128f5f83018461126d565b92915050565b5f819050919050565b6112a481610293565b82525050565b5f6020820190506112bd5f83018461129b565b92915050565b5f82825260208201905092915050565b5f6112db600a836112c4565b91506112e6826112d4565b602082019050919050565b5f6020820190508181035f830152611308816112ce565b9050919050565b5f819050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601260045260245ffd5b5f61134982610af2565b915061135483610af2565b925082611364576113636112f1565b5b828204905092915050565b7f4e6f2062616c616e636520666f722062617463680000000000000000000000005f82015250565b5f6113a76012836112c4565b91506113b28261138a565b602082019050919050565b5f6020820190508181035f8301526113d48161139a565b9050919050565b5f815190506113e581611276565b92915050565b5f8115159050919050565b6113fe6113f9826113ec565b6112a4565b82525050565b5f6020820190506114175f8301846113f5565b92915050565b5f6020820190506114305f83018461127b565b92915050565b5f60601b9050919050565b61144c61144782611435565b61142a565b82525050565b5f61145d828461143b565b60148201915081905092915050565b5f819050919050565b5f6020820190506114885f83018461130e565b92915050565b5f6020820190506114a15f830184611475565b92915050565b7f4f776e65722063616e6e6f74206265207a65726f0000000000000000000000005f82015250565b5f6114dc600d836112c4565b91506114e7826114a8565b602082019050919050565b5f6020820190508181035f830152611509816114d5565b9050919050565b5f8151905061151a81611276565b92915050565b5f8135905061152b81611511565b92915050565b5f6020828403121561154657611545610c11565b5b5f6115538482850161151c565b91505092915050565b7f5369676e617475726520766572696669636174696f6e206661696c656400005f82015250565b5f6115966017836112c4565b91506115a182611562565b602082019050919050565b5f6020820190508181035f8301526115c381611589565b905091905056fe";
  
  const abi = [
    "constructor(uint256 _fixedAmount, uint256 _maxPerClaim)",
    "function deposit() external payable",
    "function claim() external",
    "function claimBatch(uint256 times) external",
    "function setAmount(uint256 _fixedAmount, uint256 _maxPerClaim) external",
    "function emergencyWithdraw() external",
    "function transferOwnership(address newOwner) external",
    "function getBalance() external view returns (uint256)",
    "function getClaimCount(address user) external view returns (uint256)",
    "function getStats() external view returns (uint256 balance, uint256 fixedAmount_, uint256 totalClaimed_, uint256 totalDistributed_, uint256 remainingClaims)",
    "function getRemainingClaims() external view returns (uint256)",
    "function owner() external view returns (address)",
    "function fixedAmount() external view returns (uint256)",
    "function maxPerClaim() external view returns (uint256)",
    "function totalClaimed() external view returns (uint256)",
    "function totalDistributed() external view returns (uint256)",
    "function claimCount(address) external view returns (uint256)",
    "event Deposit(address indexed sender, uint256 amount)",
    "event Claim(address indexed user, uint256 amount, uint256 claimIndex)",
    "event ConfigUpdated(uint256 fixedAmount, uint256 maxPerClaim)",
    "event EmergencyWithdraw(uint256 amount)"
  ];
  
  // ÈÉ®ÁΩ≤ÂèÇÊï∞ÔºöÂõ∫ÂÆöÈáëÈ¢ù 0.01 CFXÔºåÊúÄÂ§ßÂçïÊ¨° 0.1 CFX
  const fixedAmount = ethers.parseEther("0.01");  // ÊØèÊ¨°È¢Ü 0.01 CFX
  const maxPerClaim = ethers.parseEther("0.1");   // ÊâπÈáèÈ¢ÜÂèñÊúÄÂ§ß 0.1 CFX
  
  console.log("\nÈÉ®ÁΩ≤ÂèÇÊï∞:");
  console.log("  Âõ∫ÂÆöÈáëÈ¢ù:", ethers.formatEther(fixedAmount), "CFX");
  console.log("  ÊúÄÂ§ßÂçïÊ¨°:", ethers.formatEther(maxPerClaim), "CFX");
  
  try {
    const factory = new ethers.ContractFactory(abi, bytecode, wallet);
    const contract = await factory.deploy(fixedAmount, maxPerClaim);
    
    console.log("\n‚è≥ ÈÉ®ÁΩ≤‰∫§ÊòìÂ∑≤ÂèëÈÄÅ...");
    console.log("  ‰∫§ÊòìÂìàÂ∏å:", contract.deploymentTransaction().hash);
    
    await contract.waitForDeployment();
    
    const contractAddress = await contract.getAddress();
    
    console.log("\n‚úÖ RedPacketDemo ÈÉ®ÁΩ≤ÊàêÂäü!");
    console.log("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ");
    console.log("ÂêàÁ∫¶Âú∞ÂùÄ:", contractAddress);
    console.log("ÊµèËßàÂô®:", `https://evmtestnet.confluxscan.net/address/${contractAddress}`);
    console.log("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ");
    console.log("\nüéâ ÁâπÁÇπÔºö");
    console.log("  - Áî®Êà∑ÂèØ‰ª•Êó†ÈôêÊ¨°È¢ÜÂèñ");
    console.log("  - ÊØèÊ¨°Âõ∫ÂÆö 0.01 CFX");
    console.log("  - ÊîØÊåÅÊâπÈáèÈ¢ÜÂèñ (1-100 Ê¨°)");
    console.log("  - Ë∞ÉÁî® claim() Êàñ claimBatch(times)");
    
    // ‰øùÂ≠ò‰ø°ÊÅØ
    const info = {
      contract: "RedPacketDemo",
      address: contractAddress,
      network: "Conflux eSpace Testnet",
      chainId: 71,
      fixedAmount: ethers.formatEther(fixedAmount) + " CFX",
      maxPerClaim: ethers.formatEther(maxPerClaim) + " CFX",
      explorer: `https://evmtestnet.confluxscan.net/address/${contractAddress}`
    };
    
    console.log("\nüìù ÈÉ®ÁΩ≤‰ø°ÊÅØ JSON:");
    console.log(JSON.stringify(info, null, 2));
    
  } catch (error) {
    console.error("\n‚ùå ÈÉ®ÁΩ≤Â§±Ë¥•:", error.message);
  }
}

deploy();
