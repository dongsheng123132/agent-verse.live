# 红包发放逻辑与体验策划

## 一、发放逻辑（当前合约）

- **谁发**：主办方用 Remix 或后台给合约 `deposit()` 充 CFX，充多少池子里就有多少。
- **谁领**：任何人连接 Conflux 钱包（如 Fluent），在页面点「领红包」，调用合约 `claim()`。
- **规则**：
  - 每个钱包地址**只能领一次**（合约内 `hasClaimed[address]`）。
  - 每次领到的是**随机金额**，在 `minAmount`～`maxAmount` 之间（当前 0.01～0.1 CFX）。
  - 池子里 CFX 领完为止；若余额 < minAmount，再点 `claim` 会 revert（无红包可领）。
- **没有「份数」上限**：不是「100 份领完就停」，而是「池子余额够就还能领」，直到余额不足。

总结：**先到先得，每人一次，随机金额，发完即止。**

---

## 二、按钮放在哪、什么形态

### 方案 A：简单「领红包」按钮（推荐先做）

- **位置**：春晚页左侧 **「红包资金看板」** 里，在「扫码打赏」上方或下方加一个 **「领红包」** 按钮。
- **交互**：点击 → 若未连钱包则提示安装 Fluent 并连接 Conflux eSpace 测试网 → 连上后显示「领红包」或「您已领过」/「红包已领完」→ 点「领红包」调合约 `claim()`，钱包确认后展示「恭喜领到 x CFX」。
- **优点**：实现快、逻辑清晰，马上能体验。

### 方案 B：红包雨（后期可选）

- **形态**：直播/活动页全屏或半屏飘落红包图标，用户点击某个飘落的红包再调 `claim()`；或点击后弹出「领红包」确认。
- **优点**：氛围好、适合直播场景；**缺点**：要做动画、碰撞检测、多端适配，开发量大。
- **建议**：先上线方案 A，再视效果加「红包雨」皮肤（前端动画 + 仍调同一个 `claim()`）。

### 当前实现

- 在 **SpringGala** 左侧「红包资金看板」中增加 **「领红包」** 按钮，连接 Conflux eSpace 测试网并调用已部署合约的 `claim()`，领过或余额不足时按钮置灰并提示。

---

## 三、你怎么体验

1. **确保合约已充值**：在 Remix 里对 `0x7f013f5cB9e851Bec8Ac825f89eBb0135e87a784` 执行过 `deposit()`，池子里有 CFX。
2. **浏览器**：用已安装 **Fluent** 的浏览器打开前端（如 `npm run dev` 本地或部署后的春晚页）。
3. **切到 Conflux eSpace 测试网**：Fluent 里选网络为 Conflux eSpace (Testnet)，chainId 71。
4. **打开春晚页**：导航到「春晚」/ Spring Gala，左侧找到「红包资金看板」。
5. **点「领红包」**：首次会提示连接钱包，连上后点「领红包」→ 在 Fluent 里确认交易 → 成功后页面提示领到的金额，钱包里会多一笔 CFX。
6. **再领一次**：同一地址再点会提示「您已领过」；换一个钱包/账号可以再领一次（直到池子领完）。

---

## 四、打赏 vs 红包（区分）

| 功能 | 打赏 | 红包 |
|------|------|------|
| 谁出钱 | 用户自己 | 主办方（先 deposit 到合约） |
| 用户动作 | 选金额，给指定地址/合约转 CFX | 点「领红包」，调 claim() 从池子里领一笔 |
| 当前入口 | 「扫码打赏」弹二维码，用户自己扫码转账 | 「领红包」按钮，连钱包后一键 claim |

打赏 = 用户掏钱给活动/节目；红包 = 活动方发钱，用户来领。两个可以并存，都在「红包资金看板」区域。
