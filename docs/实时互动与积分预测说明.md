# 实时互动逻辑与积分预测说明

## 一、当前「实时互动」聊天逻辑（无需登录）

### 是否要登录？

**不需要登录。** 春晚页（SpringGala）右侧的「实时互动」聊天是**匿名、纯前端**的。

### 具体逻辑

- **消息存储**：所有消息只存在前端 React state（`messages`），见 `components/SpringGala.tsx`。没有发到后端，没有数据库，没有用户表。
- **发送者身份**：用户发送时固定为 `user: 'Anonymous_Viewer'`，无 userId、昵称、钱包或社交账号绑定。
- **初始内容**：来自静态数据 `chatMessagesData`，中/英/繁三套；切换语言会重置为对应语言列表。
- **AI 回复**：根据关键词（help、submit、packet、sponsor、rules、hello 等）本地拼回复，约 1 秒后 append 一条 `user: 'AI_Host'`；无外部 AI API。
- **刷新/关页**：消息全部丢失，无持久化。

结论：当前没有登录、没有用户体系、没有积分或预测。积分与预测在单独模块（积分中心、预测市场）中实现，需登录后使用。

---

## 二、积分与预测方案（方案 A）

- **实时互动**：保持现状，匿名、无需登录。
- **积分中心 / 预测市场**：单独入口，进入时要求登录（或使用临时 guest 身份）；积分与预测走后端 API + 数据库（或内存存储 MVP）。

### 积分规则建议

| 行为         | 积分               |
| ------------ | ------------------ |
| 注册         | +100               |
| 邀请成功     | 邀请人 +20，被邀 +10 |
| 每日签到     | +5（可选）         |
| 参与预测下注 | 扣积分             |
| 预测正确     | 返还 + 奖励        |

### 预测玩法

- 题目：如「哪个节目点赞最高」「AI 节目是否上热搜」等，带选项（A/B/C 或 是/否）。
- 参与：用户用积分下注（选选项、扣积分）；每人每题限下注一次。
- 结算：约定时间根据结果结算；猜对返还+奖励，猜错扣掉下注。

### 技术要点

- 登录：Privy / Dynamic 等（或 MVP 阶段用 guest id + Bearer）。
- 数据库：用户表（user_id, invite_code, points, created_at）、邀请关系、预测题目与选项、用户下注记录。
- 后端：注册/登录回调、积分变更、邀请绑定、下注、结算等 API。
- 前端：积分中心页、预测市场页，从春晚页或主导航进入。

详见方案文档与 `server/local-api.ts` 中 `/api/v1/points/*`、`/api/v1/predictions/*` 的实现。
